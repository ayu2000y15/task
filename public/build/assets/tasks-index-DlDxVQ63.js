import{a as k}from"./app-BKGCNJKk.js";function y(n){switch(n){case"completed":return'<i class="fas fa-check-circle text-green-500" title="完了"></i>';case"in_progress":return'<i class="fas fa-play-circle text-blue-500" title="進行中"></i>';case"on_hold":return'<i class="fas fa-pause-circle text-yellow-500" title="保留中"></i>';case"cancelled":return'<i class="fas fa-times-circle text-red-500" title="キャンセル"></i>';case"not_started":default:return'<i class="far fa-circle text-gray-400" title="未着手"></i>'}}function m(n,e,i){if(!n)return;const c=n.querySelector(".task-status-icon-wrapper");if(c){let t=!1;if(n.tagName.toLowerCase()==="tr"){const o=n.querySelector("td:nth-child(2)");o&&(t=!!(o.querySelector("i.fa-flag")||o.querySelector("i.fa-folder")))}else n.tagName.toLowerCase()==="li"&&(t=!!(c.querySelector("i.fa-flag")||c.querySelector("i.fa-folder")));t||(c.innerHTML=y(e))}n.dataset.progress=i;const l=n.querySelector(".task-status-select");l&&(l.value=e,l.dataset.originalStatus=e,l.dataset.currentProgress=i)}function x(){document.querySelectorAll(".task-status-checkbox").forEach(e=>{e.addEventListener("change",function(){const i=this.closest("tr, li");if(!i){console.warn("Checkbox event couldn't find parent <tr> or <li>",this);return}const c=i.dataset.taskId,l=i.dataset.projectId,t=this.dataset.action,o=this.checked;if(!c||!l){console.warn("Missing taskId or projectId on row:",i),this.checked=!o;return}const s=i.querySelector(".task-status-in-progress"),a=i.querySelector(".task-status-completed");let r="not_started",d=0,u=parseInt(i.dataset.progress||"0");isNaN(u)&&(u=0),o&&(t==="set-in-progress"?a&&(a.checked=!1):t==="set-completed"&&s&&(s.checked=!1)),s&&s.checked?(r="in_progress",u>0&&u<100?d=u:u===100?d=90:d=10):a&&a.checked?(r="completed",d=100):(r="not_started",d=0);const g=s?s.checked:!1,f=a?a.checked:!1;s&&(s.checked=r==="in_progress"),a&&(a.checked=r==="completed"),k.post(`/projects/${l}/tasks/${c}/progress`,{status:r,progress:d}).then(h=>{h.data.success?(m(i,r,d),document.querySelector("h1.text-2xl")&&(document.querySelector("h5.text-lg")||document.querySelector("h2.text-xl"))&&(r==="completed"||r==="cancelled"||r==="on_hold"||r==="not_started")&&location.reload()):(alert("更新に失敗: "+(h.data.message||"不明なエラー")),s&&(s.checked=g),a&&(a.checked=f))}).catch(h=>{console.error("Error updating task via checkbox:",h),alert("更新中にエラーが発生しました。"),s&&(s.checked=g),a&&(a.checked=f)})})})}function S(){document.querySelectorAll(".task-status-select").forEach(e=>{const i=e.closest("tr, li");i&&(e.dataset.originalStatus=e.value,e.dataset.currentProgress=i.dataset.progress||"0",e.addEventListener("change",function(){const c=this.dataset.taskId,l=this.dataset.projectId,t=this.value;let o=0,s=parseInt(this.dataset.currentProgress);isNaN(s)&&(s=0),t==="completed"?o=100:t==="not_started"||t==="cancelled"?o=0:t==="in_progress"?s===0?o=10:s===100?o=90:o=s>0?s:10:o=s,k.post(`/projects/${l}/tasks/${c}/progress`,{status:t,progress:o}).then(a=>{if(a.data.success){const r=this.closest("tr, li");if(r){m(r,t,o);const u=r.querySelector(".task-status-in-progress"),g=r.querySelector(".task-status-completed");u&&(u.checked=t==="in_progress"),g&&(g.checked=t==="completed")}!!document.querySelector("h1.text-2xl")&&(!!document.querySelector("h5.text-lg")||!!document.querySelector("h2.text-xl"))&&(t==="completed"||t==="cancelled"||t==="on_hold"||t==="not_started")&&location.reload()}else alert("ステータスの更新に失敗しました: "+(a.data.message||"")),this.value=this.dataset.originalStatus||"not_started"}).catch(a=>{console.error("Error updating task status:",a),alert("ステータス更新中にエラーが発生しました。"),this.value=this.dataset.originalStatus||"not_started"})}))})}function I(){document.querySelectorAll('.editable-cell[data-field="assignee"]').forEach(e=>{if(!e.closest("tr"))return;const c=e.textContent.trim();e.dataset.originalValue=c==="-"?"":c,e.addEventListener("click",function(){if(this.querySelector("input.assignee-edit-input"))return;const t=this.dataset.originalValue||"",o=this.dataset.taskId,s=this.dataset.projectId;if(!o||!s){const f=this.closest("tr");f&&(o||(this.dataset.taskId=f.dataset.taskId),s||(this.dataset.projectId=f.dataset.projectId))}const a=this.dataset.taskId,r=this.dataset.projectId;this.innerHTML=`<input type="text" value="${t}" class="assignee-edit-input form-input w-full text-sm p-1 border border-blue-500 rounded dark:bg-gray-700 dark:text-gray-200" placeholder="担当者名">`;const d=this.querySelector("input.assignee-edit-input");if(!d)return;d.focus(),d.select();const u=()=>{const f=e.querySelector("input.assignee-edit-input");if(!f)return;const h=f.value.trim();e.innerHTML=h||"-",e.dataset.originalValue=h,h!==t&&a&&r&&k.post(`/projects/${r}/tasks/${a}/assignee`,{assignee:h}).then(p=>{p.data.success||(e.innerHTML=t||"-",e.dataset.originalValue=t,alert("担当者の更新に失敗しました: "+(p.data.message||"")))}).catch(p=>{console.error("Error updating assignee:",p),e.innerHTML=t||"-",e.dataset.originalValue=t,alert("担当者更新中にエラーが発生しました。")}),f.removeEventListener("blur",u)},g=f=>{if(f.key==="Enter")f.preventDefault(),u();else if(f.key==="Escape"){const h=e.querySelector("input.assignee-edit-input");h&&(h.value=t),u()}};d.addEventListener("blur",u,{once:!0}),d.addEventListener("keydown",g)})})}function q(){document.querySelectorAll(".toggle-folder-files").forEach(e=>{const i=e.dataset.target;i&&e.addEventListener("click",function(){const c=document.getElementById(i),l=this.querySelector("i");c&&(c.classList.toggle("hidden"),c.classList.contains("hidden")?(l.classList.remove("fa-chevron-up"),l.classList.add("fa-chevron-down")):(l.classList.remove("fa-chevron-down"),l.classList.add("fa-chevron-up")))})})}try{S(),x(),I(),q()}catch(n){console.error("Error during tasks-index.js specific initialization:",n)}const E={};export{E as default};
