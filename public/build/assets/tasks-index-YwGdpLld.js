import{a as p}from"./app-DDrHPeG2.js";function h(s){switch(s){case"completed":return'<i class="fas fa-check-circle text-green-500" title="完了"></i>';case"in_progress":return'<i class="fas fa-play-circle text-blue-500" title="進行中"></i>';case"on_hold":return'<i class="fas fa-pause-circle text-yellow-500" title="保留中"></i>';case"cancelled":return'<i class="fas fa-times-circle text-red-500" title="キャンセル"></i>';case"not_started":default:return'<i class="far fa-circle text-gray-400" title="未着手"></i>'}}function g(s,a,e){if(!s)return;const n=s.querySelector(".task-status-icon-wrapper");if(n){let c=!1;if(s.tagName.toLowerCase()==="tr"){const o=s.querySelector("td:nth-child(2)");o&&(c=!!(o.querySelector("i.fa-flag")||o.querySelector("i.fa-folder")))}else s.tagName.toLowerCase()==="li"&&(c=!!(n.querySelector("i.fa-flag")||n.querySelector("i.fa-folder")));c||(n.innerHTML=h(a))}s.dataset.progress=e;const r=s.querySelector(".task-status-select");r&&(r.value=a,r.dataset.originalStatus=a,r.dataset.currentProgress=e)}function k(){document.querySelectorAll(".task-status-checkbox").forEach(s=>{s.addEventListener("change",function(){const a=this.closest("tr, li");if(!a)return;const e=a.dataset.taskId,n=a.dataset.projectId,r=this.dataset.action;if(!e||!n)return;const c=a.querySelector(".task-status-in-progress"),o=a.querySelector(".task-status-completed");let i="not_started",t=0,l=parseInt(a.dataset.progress||"0")||0;this.checked&&(r==="set-in-progress"&&o&&(o.checked=!1),r==="set-completed"&&c&&(c.checked=!1)),c!=null&&c.checked?(i="in_progress",t=l>0&&l<100?l:10):o!=null&&o.checked&&(i="completed",t=100),p.post(`/projects/${n}/tasks/${e}/progress`,{status:i,progress:t}).then(d=>{d.data.success&&g(a,i,t)})})})}function m(){document.querySelectorAll(".task-status-select").forEach(s=>{s.addEventListener("change",function(){var o;const a=this.dataset.taskId,e=this.dataset.projectId,n=this.value;let r=0,c=parseInt(((o=this.closest("tr, li"))==null?void 0:o.dataset.progress)||"0")||0;n==="completed"?r=100:n==="in_progress"&&(r=c>0&&c<100?c:10),p.post(`/projects/${e}/tasks/${a}/progress`,{status:n,progress:r}).then(i=>{if(i.data.success){const t=this.closest("tr, li");g(t,n,r);const l=t==null?void 0:t.querySelector(".task-status-in-progress"),d=t==null?void 0:t.querySelector(".task-status-completed");l&&(l.checked=n==="in_progress"),d&&(d.checked=n==="completed")}})})})}function y(){const s=document.querySelector("[data-assignee-options]");if(!s)return;const a=JSON.parse(s.dataset.assigneeOptions);document.querySelectorAll('.editable-cell[data-field="assignee"]').forEach(e=>{e.addEventListener("click",function(){if(e.querySelector("select"))return;const r=e.closest("tr");if(!r)return;const c=r.dataset.taskId,o=r.dataset.projectId,i=e.textContent.trim()==="-"?"":e.textContent.trim();e.innerHTML="";const t=document.createElement("select");t.className="form-select w-full text-sm p-1 border-blue-500 rounded dark:bg-gray-700 dark:text-gray-200";const l=document.createElement("option");l.value="",l.textContent="未割り当て",t.appendChild(l),a.forEach(u=>{const f=document.createElement("option");f.value=u,f.textContent=u,u===i&&(f.selected=!0),t.appendChild(f)}),e.appendChild(t),t.focus();const d=()=>{const u=t.value;e.innerHTML=u||"-",u!==i&&p.post(`/projects/${o}/tasks/${c}/assignee`,{assignee:u}).catch(f=>{console.error("Error updating assignee:",f),alert("担当者の更新中にエラーが発生しました。"),e.innerHTML=i||"-"})};t.addEventListener("change",d),t.addEventListener("blur",d)})})}function S(){document.querySelectorAll(".toggle-folder-files").forEach(s=>{s.addEventListener("click",function(){const a=document.getElementById(this.dataset.target),e=this.querySelector("i");!a||!e||(a.classList.toggle("hidden"),e.classList.toggle("fa-chevron-down"),e.classList.toggle("fa-chevron-up"))})})}try{m(),k(),y(),S()}catch(s){console.error("Error during tasks-index.js specific initialization:",s)}
