import{a as w}from"./app-ChqURTr7.js";const F={0:{tooltip:"未納品",icon:"fa-truck",colorClass:"text-yellow-500 dark:text-yellow-400"},1:{tooltip:"納品済み",icon:"fa-check-circle",colorClass:"text-green-500 dark:text-green-400"}},M={Pending:{tooltip:"未払い",icon:"fa-clock",colorClass:"text-yellow-500 dark:text-yellow-400"},Processing:{tooltip:"支払い中",icon:"fa-hourglass-half",colorClass:"text-blue-500 dark:text-blue-400"},Completed:{tooltip:"支払完了",icon:"fa-check-circle",colorClass:"text-green-500 dark:text-green-400"},"Partially Paid":{tooltip:"一部支払い",icon:"fa-adjust",colorClass:"text-orange-500 dark:text-orange-400"},Overdue:{tooltip:"期限切れ",icon:"fa-exclamation-triangle",colorClass:"text-red-500 dark:text-red-400"},Cancelled:{tooltip:"キャンセル",icon:"fa-ban",colorClass:"text-gray-500 dark:text-gray-400"},Refunded:{tooltip:"返金済み",icon:"fa-undo",colorClass:"text-purple-500 dark:text-purple-400"},"On Hold":{tooltip:"保留中",icon:"fa-pause-circle",colorClass:"text-indigo-500 dark:text-indigo-400"},"":{tooltip:"未設定",icon:"fa-question-circle",colorClass:"text-gray-400 dark:text-gray-500"}},L={not_started:{tooltip:"未着手",icon:"fa-minus-circle",colorClass:"text-gray-500 dark:text-gray-400"},in_progress:{tooltip:"進行中",icon:"fa-play-circle",colorClass:"text-blue-500 dark:text-blue-400"},completed:{tooltip:"完了",icon:"fa-check-circle",colorClass:"text-green-500 dark:text-green-400"},on_hold:{tooltip:"保留中",icon:"fa-pause-circle",colorClass:"text-yellow-500 dark:text-yellow-400"},cancelled:{tooltip:"キャンセル",icon:"fa-times-circle",colorClass:"text-red-500 dark:text-red-400"},"":{tooltip:"未設定",icon:"fa-question-circle",colorClass:"text-gray-400 dark:text-gray-500"}};function S(e,t,s){if(e){const a=Object.keys(s).includes("")?"":Object.keys(s)[0],o=s[t]||s[a]||{tooltip:t||"-",icon:"fa-question-circle",colorClass:"text-gray-400 dark:text-gray-500"};e.title=o.tooltip;const n=e.querySelector("i");if(n){const d=Array.from(n.classList).filter(i=>i.startsWith("fa-")||i.startsWith("text-")||i.startsWith("dark:text-"));n.classList.remove(...d);const r=o.icon.split(" ");n.classList.add("fas",...r),o.colorClass&&o.colorClass.split(" ").forEach(i=>n.classList.add(i))}else e.innerHTML=`<i class="fas ${o.icon} ${o.colorClass||""}"></i>`}}function H(e,t){e.dataset.projectId;const s=e.name,a=e.value,o=e.dataset.url,n=e.dataset.iconTarget,d=document.getElementById(n);w.patch(o,{[s]:a},{headers:{"X-CSRF-TOKEN":t,Accept:"application/json","Content-Type":"application/json"}}).then(r=>{if(r.data.success){if(d){let i;s==="delivery_flag"?i=F:s==="payment_flag"?i=M:s==="status"&&(i=L),i&&S(d,a,i)}if(r.data.updated_project_status!==void 0){const i=e.dataset.statusTargetSelect,c=e.dataset.statusTargetIcon;if(i){const m=document.getElementById(i);m&&(m.value=r.data.updated_project_status)}if(c){const m=document.getElementById(c);m&&S(m,r.data.updated_project_status,L)}}}else alert("更新に失敗しました: "+(r.data.message||"サーバーエラー"))}).catch(r=>{let i="更新中にエラーが発生しました。";r.response&&r.response.data&&r.response.data.message?i+=`
`+r.response.data.message:r.response&&r.response.status&&(i+=` (ステータス: ${r.response.status})`),alert(i)})}function v(e,t="処理に失敗しました。",s=null){let a=t,o=null;if(e&&e.data){if(e.data.message&&(typeof e.data.message!="object"||Object.keys(e.data.message).length>0)&&(a=e.data.message),e.data.errors){o=e.data.errors;let d=[];for(const r in o)d.push(o[r].join("; "));d.length>0&&a===t&&(a=d.join(`
`))}}else e&&typeof e=="string"&&(a=e);const n=s?document.getElementById(s):null;if(n&&o){let d='<ul class="list-disc pl-5 text-red-600 dark:text-red-400">';for(const i in o)o[i].forEach(c=>{d+=`<li>${$(c)}</li>`});d+="</ul>",n.innerHTML=d;const r=n.closest("form");r&&Object.keys(o).forEach(i=>{const c=i.includes(".")?i.split(".").map((y,f)=>f===0?y:`[${y}]`).join(""):i,m=r.querySelector(`[name="${c}"], [name="${c}[]"]`);m&&m.classList.add("border-red-500","dark:border-red-600")})}else n&&a?n.innerHTML=`<p class="text-red-600 dark:text-red-400">${h($(String(a)))}</p>`:a&&!n&&alert(String(a))}function k(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):null}function $(e){return e===null||typeof e>"u"?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function h(e){return typeof e>"u"||e===null?"":String(e).replace(/(\r\n|\n\r|\r|\n)/g,"<br>$1")}function B(e,t){const s=document.getElementById(`costs-content-${t}`);if(!s){console.warn(`Could not find costs tab container for character: ${t}`);return}const a=`/projects/${e}/characters/${t}/costs-partial`;w.get(a).then(o=>{s.innerHTML=o.data}).catch(o=>{console.error("Error refreshing costs list:",o),s.innerHTML='<p class="text-red-500 p-4">コスト情報の更新に失敗しました。</p>'})}function C(e,t){const s=document.getElementById(`measurement-form-${e}`);if(!s){console.warn(`Measurement form not found for reset: measurement-form-${e}`);return}s.reset(),s.setAttribute("action",t);const a=document.getElementById(`measurement-form-method-${e}`);a&&(a.value="POST");const o=document.getElementById(`measurement-form-id-${e}`);o&&(o.value="");const n=document.getElementById(`measurement-form-title-${e}`);n&&(n.textContent="採寸データを追加");const d=document.getElementById(`measurement-form-submit-btn-text-${e}`);d&&(d.textContent="追加");const r=document.getElementById(`measurement-form-submit-btn-${e}`);r&&(r.classList.remove("bg-yellow-500","hover:bg-yellow-600","active:bg-yellow-700","focus:border-yellow-700","focus:ring-yellow-300"),r.classList.add("bg-green-500","hover:bg-green-600","active:bg-green-700","focus:border-green-700","focus:ring-green-300"));const i=document.getElementById(`measurement-form-cancel-btn-${e}`);i&&(i.style.display="none");const c=document.getElementById(`measurement-form-errors-${e}`);c&&(c.innerHTML=""),s.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(m=>{m.classList.remove("border-red-500","dark:border-red-600")})}function A(e,t,s,a){const o=document.querySelector(`#measurements-content-${e} table tbody`);if(!o){console.warn(`Measurement table body not found for character ${e}`);return}const n=document.getElementById(`measurement-row-${t.id}`),d=t.notes?h($(t.notes)):"-",r=k();let i='<div class="flex items-center justify-end space-x-1">';i+=`
        <button type="button" class="p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 edit-measurement-btn"
                title="編集"
                data-id="${t.id}"
                data-item="${$(t.item||"")}"
                data-value="${$(t.value||"")}"
                data-notes="${$(t.notes||"")}">
            <i class="fas fa-edit fa-sm"></i>
        </button>`,i+=`
        <form action="/projects/${a.id}/characters/${e}/measurements/${t.id}"
              method="POST" class="delete-measurement-form"
              data-id="${t.id}"
              onsubmit="return false;">
            <input type="hidden" name="_token" value="${r}">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit"
                class="p-1 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"
                title="削除">
                <i class="fas fa-trash fa-sm"></i>
            </button>
        </form>`,i+="</div>";const c=`
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 measurement-item">${$(t.item)}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 measurement-value">${$(t.value)}</td>
        <td class="px-4 py-1.5 text-gray-700 dark:text-gray-200 whitespace-pre-wrap break-words text-left leading-tight measurement-notes" style="min-width: 150px;">
            ${d}
        </td>
        <td class="px-3 py-1.5 whitespace-nowrap text-right">
            ${i}
        </td>
    `;if(s&&n)n.innerHTML=c;else if(!s){const m=document.createElement("tr");m.id=`measurement-row-${t.id}`,m.classList.add("hover:bg-gray-50","dark:hover:bg-gray-700/50"),m.innerHTML=c;const y=o.querySelector('td[colspan="4"]');y&&y.parentElement.remove(),o.appendChild(m)}}function P(e,t,s,a){const o=document.getElementById(`measurement-form-${t}`);if(!o){console.warn(`Measurement form not found for character ${t}`);return}const n=o.dataset.storeUrl,d=document.getElementById(`measurement-form-title-${t}`),r=document.getElementById(`measurement-form-submit-btn-${t}`),i=document.getElementById(`measurement-form-submit-btn-text-${t}`),c=document.getElementById(`measurement-form-cancel-btn-${t}`),m=document.getElementById(`measurement-form-method-${t}`),y=document.getElementById(`measurement-form-id-${t}`),f=`measurement-form-errors-${t}`;e.addEventListener("click",function(g){const l=g.target.closest(".edit-measurement-btn");if(l){g.preventDefault(),d&&(d.textContent="採寸データを編集"),o.setAttribute("action",`/projects/${a.id}/characters/${t}/measurements/${l.dataset.id}`),m&&(m.value="PUT"),y&&(y.value=l.dataset.id);const u=o.querySelector(`[id="measurement_item_input-${t}"]`),x=o.querySelector(`[id="measurement_value_input-${t}"]`),p=o.querySelector(`[id="measurement_notes_input-${t}"]`);u&&(u.value=l.dataset.item),x&&(x.value=l.dataset.value),p&&(p.value=l.dataset.notes||""),i&&(i.textContent="更新"),r&&(r.classList.remove("bg-green-500","hover:bg-green-600"),r.classList.add("bg-yellow-500","hover:bg-yellow-600")),c&&(c.style.display="inline-flex");const E=document.getElementById(f);E&&(E.innerHTML=""),u&&u.focus()}const b=g.target.closest(".delete-measurement-form");b&&(g.preventDefault(),confirm("この採寸データを本当に削除しますか？")&&w.delete(b.action,{headers:{"X-CSRF-TOKEN":s,Accept:"application/json"}}).then(u=>{if(u.data.success){const x=`measurement-row-${b.dataset.id}`,p=document.getElementById(x);p&&p.remove(),C(t,n)}else v(u,"削除に失敗しました。",f)}).catch(u=>{v(u.response,"削除中にエラーが発生しました。",f)}))}),c&&c.addEventListener("click",function(){C(t,n)}),o.addEventListener("submit",function(g){g.preventDefault();const l=document.getElementById(f);l&&(l.innerHTML="");const b=new FormData(o),u=o.getAttribute("action");let x="post";document.getElementById(`measurement-form-method-${t}`).value==="PUT"&&b.append("_method","PUT"),w({method:x,url:u,data:b,headers:{"X-CSRF-TOKEN":s,Accept:"application/json"}}).then(p=>{if(p.data.success&&p.data.measurement){const E=document.getElementById(`measurement-form-method-${t}`).value==="PUT";A(t,p.data.measurement,E,a),C(t,n)}else v(p,"処理に失敗しました。",f)}).catch(p=>{v(p.response,"送信中にエラーが発生しました。",f)})})}function T(e,t){const s=document.getElementById(`material-form-${e}`);if(!s){console.warn(`Material form not found for reset: material-form-${e}`);return}s.reset(),s.setAttribute("action",t);const a=document.getElementById(`material-form-method-${e}`);a&&(a.value="POST");const o=document.getElementById(`material-form-id-${e}`);o&&(o.value="");const n=document.getElementById(`material-form-title-${e}`);n&&(n.textContent="材料を追加");const d=document.getElementById(`material-form-submit-btn-text-${e}`);d&&(d.textContent="追加");const r=document.getElementById(`material-form-submit-btn-${e}`);r&&(r.classList.remove("bg-yellow-500","hover:bg-yellow-600","active:bg-yellow-700","focus:border-yellow-700","focus:ring-yellow-300"),r.classList.add("bg-green-500","hover:bg-green-600","active:bg-green-700","focus:border-green-700","focus:ring-green-300"));const i=document.getElementById(`material-form-cancel-btn-${e}`);i&&(i.style.display="none");const c=document.getElementById(`material-form-errors-${e}`);c&&(c.innerHTML=""),s.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(m=>{m.classList.remove("border-red-500","dark:border-red-600")})}function j(e,t,s,a){const o=document.querySelector(`#materials-content-${e} table tbody`);if(!o){console.warn(`Material table body not found for character ${e}`);return}const n=document.getElementById(`material-row-${t.id}`),d=t.notes?h($(t.notes)):"-",r=t.price!==null?Number(t.price).toLocaleString()+"円":"-",i=k(),c=`/projects/${a.id}/characters/${e}/materials/${t.id}`;let m='<div class="flex items-center justify-end space-x-1">';m+=`
        <button type="button" class="p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 edit-material-btn"
                title="編集"
                data-id="${t.id}"
                data-name="${$(t.name||"")}"
                data-price="${t.price||""}"
                data-quantity_needed="${$(t.quantity_needed||"")}"
                data-notes="${$(t.notes||"")}">
            <i class="fas fa-edit fa-sm"></i>
        </button>`,m+=`
        <form action="/projects/${a.id}/characters/${e}/materials/${t.id}"
              method="POST" class="delete-material-form"
              data-id="${t.id}"
              onsubmit="return false;">
            <input type="hidden" name="_token" value="${i}">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit"
                class="p-1 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"
                title="削除">
                <i class="fas fa-trash fa-sm"></i>
            </button>
        </form>`,m+="</div>";const f=`
        <td class="px-3 py-1.5 whitespace-nowrap">
            ${`
        <input type="checkbox"
            id="material-status-checkbox-${t.id}"
            class="form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:bg-gray-900 dark:border-gray-600 material-status-checkbox"
            data-url="${c}"
            data-id="${t.id}" data-character-id="${e}"
            ${t.status==="購入済"?"checked":""}>`}
        </td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 material-name">${$(t.name)}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 material-price">${r}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 material-quantity_needed">${$(t.quantity_needed)}</td>
        <td class="px-4 py-1.5 text-gray-700 dark:text-gray-200 whitespace-pre-wrap break-words text-left leading-tight material-notes" style="min-width: 150px;">
            ${d}
        </td>
        <td class="px-3 py-1.5 whitespace-nowrap text-right">
            ${m}
        </td>
    `;if(s&&n)n.innerHTML=f;else if(!s){const g=document.createElement("tr");g.id=`material-row-${t.id}`,g.classList.add("hover:bg-gray-50","dark:hover:bg-gray-700/50"),g.innerHTML=f;const l=o.querySelector('td[colspan="6"]');l&&l.parentElement.remove(),o.appendChild(g)}}function R(e,t,s,a){const o=document.getElementById(`material-form-${t}`);if(!o){console.warn(`Material form not found for character ${t}. Aborting init for this character's materials.`);return}const n=o.dataset.storeUrl,d=document.getElementById(`material-form-title-${t}`),r=document.getElementById(`material-form-submit-btn-${t}`),i=document.getElementById(`material-form-submit-btn-text-${t}`),c=document.getElementById(`material-form-cancel-btn-${t}`),m=document.getElementById(`material-form-method-${t}`),y=document.getElementById(`material-form-id-${t}`),f=`material-form-errors-${t}`;e.addEventListener("click",function(g){const l=g.target.closest(".edit-material-btn");if(l){g.preventDefault(),d&&(d.textContent="材料を編集"),o.setAttribute("action",`/projects/${a.id}/characters/${t}/materials/${l.dataset.id}`),m&&(m.value="PUT"),y&&(y.value=l.dataset.id),o.elements.name.value=l.dataset.name,o.elements.price.value=l.dataset.price||"",o.elements.quantity_needed.value=l.dataset.quantity_needed,o.elements.notes.value=l.dataset.notes||"",i&&(i.textContent="更新"),r&&(r.classList.remove("bg-green-500","hover:bg-green-600"),r.classList.add("bg-yellow-500","hover:bg-yellow-600")),c&&(c.style.display="inline-flex");const u=document.getElementById(f);u&&(u.innerHTML=""),o.elements.name.focus()}const b=g.target.closest(".delete-material-form");b&&(g.preventDefault(),confirm("この材料を本当に削除しますか？")&&w.delete(b.action,{headers:{"X-CSRF-TOKEN":s,Accept:"application/json"}}).then(u=>{if(u.data.success){const x=`material-row-${b.dataset.id}`,p=document.getElementById(x);p&&p.remove(),T(t,n),u.data.costs_updated&&B(a.id,t)}else v(u,"削除に失敗しました。",f)}).catch(u=>{v(u.response,"削除中にエラーが発生しました。",f)}))}),c&&c.addEventListener("click",function(){T(t,n)}),o.addEventListener("submit",function(g){g.preventDefault();const l=document.getElementById(f);l&&(l.innerHTML="");const b=new FormData(o),u=o.getAttribute("action");let x="post";document.getElementById(`material-form-method-${t}`).value==="PUT"&&b.append("_method","PUT"),w({method:x,url:u,data:b,headers:{"X-CSRF-TOKEN":s,Accept:"application/json"}}).then(p=>{if(p.data.success&&p.data.material){const E=document.getElementById(`material-form-method-${t}`).value==="PUT";j(t,p.data.material,E,a),T(t,n),p.data.costs_updated&&B(a.id,t)}else v(p,"処理に失敗しました。",f)}).catch(p=>{v(p.response,"送信中にエラーが発生しました。",f)})}),e.addEventListener("change",function(g){const l=g.target.closest(".material-status-checkbox");if(l&&l.dataset.characterId===t){l.dataset.id;const b=l.checked?"購入済":"未購入",u=l.dataset.url;w.put(u,{status:b},{headers:{"X-CSRF-TOKEN":s,Accept:"application/json","Content-Type":"application/json"}}).then(x=>{x.data.success&&x.data.material?(j(t,x.data.material,!0,a),x.data.costs_updated&&B(a.id,t)):(v(x,"ステータス更新に失敗しました。",f),l.checked=!l.checked)}).catch(x=>{v(x.response,"ステータス更新中にエラーが発生しました。",f),l.checked=!l.checked})}})}function q(e){const t=document.getElementById(`costs-content-${e}`);if(!t){console.warn(`Costs tab container not found for total update: costs-content-${e}`);return}const s=t.querySelector("table tbody");if(!s)return;let a=0;s.querySelectorAll('tr[id^="cost-row-"]').forEach(n=>{const d=n.querySelector(".cost-amount");d&&(a+=parseFloat(String(d.textContent).replace(/[^0-9.-]+/g,""))||0)});const o=t.querySelector(".p-3.rounded-md span.font-semibold");if(o){o.textContent=Number(a).toLocaleString()+"円";const n=o.closest(".p-3.rounded-md");n&&(a>0?(n.classList.remove("bg-gray-100","text-gray-700","dark:bg-gray-700/30","dark:text-gray-300"),n.classList.add("bg-green-100","text-green-700","dark:bg-green-700/30","dark:text-green-200")):(n.classList.remove("bg-green-100","text-green-700","dark:bg-green-700/30","dark:text-green-200"),n.classList.add("bg-gray-100","text-gray-700","dark:bg-gray-700/30","dark:text-gray-300")))}}function _(e,t){const s=document.getElementById(`cost-form-${e}`);if(!s){console.warn(`Cost form not found for reset: cost-form-${e}`);return}s.reset(),s.setAttribute("action",t);const a=document.getElementById(`cost-form-method-${e}`);a&&(a.value="POST");const o=document.getElementById(`cost-form-id-${e}`);o&&(o.value="");const n=document.getElementById(`cost-form-title-${e}`);n&&(n.textContent="コストを追加");const d=document.getElementById(`cost-form-submit-btn-text-${e}`);d&&(d.textContent="追加");const r=document.getElementById(`cost-form-submit-btn-${e}`);r&&(r.classList.remove("bg-yellow-500","hover:bg-yellow-600","active:bg-yellow-700","focus:border-yellow-700","focus:ring-yellow-300"),r.classList.add("bg-green-500","hover:bg-green-600","active:bg-green-700","focus:border-green-700","focus:ring-green-300"));const i=document.getElementById(`cost-form-cancel-btn-${e}`);i&&(i.style.display="none");const c=document.getElementById(`cost-form-errors-${e}`);c&&(c.innerHTML=""),s.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(y=>{y.classList.remove("border-red-500","dark:border-red-600")});const m=s.querySelector(`#cost_cost_date_input-${e}`)||s.querySelector('[id^="cost_cost_date_input"]');if(m&&!(o&&o.value)){const y=new Date,f=y.getFullYear(),g=String(y.getMonth()+1).padStart(2,"0"),l=String(y.getDate()).padStart(2,"0");m.value=`${f}-${g}-${l}`}}function U(e,t,s,a){const o=document.querySelector(`#costs-content-${e} table tbody`);if(!o){console.warn(`Cost table body not found for character ${e}`);return}const n=document.getElementById(`cost-row-${t.id}`),d=t.notes?h($(t.notes)):"-",r=Number(t.amount).toLocaleString()+"円",i=t.cost_date?new Date(t.cost_date+"T00:00:00Z").toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"UTC"}):"-",c=k();let m="",y="bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-100";t.type==="材料費"?y="bg-blue-100 text-blue-800 dark:bg-blue-700 dark:text-blue-100":t.type==="作業費"&&(y="bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100"),m=`<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y}">${$(t.type)}</span>`;let f='<div class="flex items-center justify-end space-x-1">';f+=`
        <button type="button" class="p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 edit-cost-btn"
                title="編集"
                data-id="${t.id}"
                data-cost_date="${t.cost_date?t.cost_date.substring(0,10):""}"
                data-type="${$(t.type||"")}"
                data-amount="${t.amount||""}"
                data-item_description="${$(t.item_description||"")}"
                data-notes="${$(t.notes||"")}">
            <i class="fas fa-edit fa-sm"></i>
        </button>`,f+=`
        <form action="/projects/${a.id}/characters/${e}/costs/${t.id}"
              method="POST" class="delete-cost-form"
              data-id="${t.id}"
              onsubmit="return false;">
            <input type="hidden" name="_token" value="${c}">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit"
                class="p-1 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"
                title="削除">
                <i class="fas fa-trash fa-sm"></i>
            </button>
        </form>`,f+="</div>";const g=`
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 cost-cost_date">${i}</td>
        <td class="px-4 py-1.5 whitespace-nowrap cost-type">${m}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 cost-amount">${r}</td>
        <td class="px-4 py-1.5 whitespace-normal break-words text-gray-700 dark:text-gray-200 cost-item_description">${$(t.item_description)}</td>
        <td class="px-4 py-1.5 text-gray-700 dark:text-gray-200 whitespace-pre-wrap break-words text-left leading-tight cost-notes" style="min-width: 150px;">
            ${d}
        </td>
        <td class="px-3 py-1.5 whitespace-nowrap text-right">
            ${f}
        </td>
    `;if(s&&n)n.innerHTML=g;else if(!s){const l=document.createElement("tr");l.id=`cost-row-${t.id}`,l.classList.add("hover:bg-gray-50","dark:hover:bg-gray-700/50"),l.innerHTML=g;const b=o.querySelector('td[colspan="6"]');b&&b.parentElement.remove(),o.appendChild(l)}q(e)}function O(e,t,s,a){const o=document.getElementById(`cost-form-${t}`);if(!o){console.warn(`Cost form not found for character ${t}`);return}const n=o.dataset.storeUrl,d=document.getElementById(`cost-form-title-${t}`),r=document.getElementById(`cost-form-submit-btn-${t}`),i=document.getElementById(`cost-form-submit-btn-text-${t}`),c=document.getElementById(`cost-form-cancel-btn-${t}`),m=document.getElementById(`cost-form-method-${t}`),y=document.getElementById(`cost-form-id-${t}`),f=`cost-form-errors-${t}`;e.addEventListener("click",function(g){const l=g.target.closest(".edit-cost-btn");if(l){g.preventDefault(),d&&(d.textContent="コストを編集"),o.setAttribute("action",`/projects/${a.id}/characters/${t}/costs/${l.dataset.id}`),m&&(m.value="PUT"),y&&(y.value=l.dataset.id),o.querySelector(`[id="cost_cost_date_input-${t}"]`).value=l.dataset.cost_date,o.querySelector(`[id="cost_type_input-${t}"]`).value=l.dataset.type,o.querySelector(`[id="cost_amount_input-${t}"]`).value=l.dataset.amount,o.querySelector(`[id="cost_item_description_input-${t}"]`).value=l.dataset.item_description,o.querySelector(`[id="cost_notes_input-${t}"]`).value=l.dataset.notes||"",i&&(i.textContent="更新"),r&&(r.classList.remove("bg-green-500","hover:bg-green-600"),r.classList.add("bg-yellow-500","hover:bg-yellow-600")),c&&(c.style.display="inline-flex");const u=document.getElementById(f);u&&(u.innerHTML=""),o.querySelector(`[id="cost_cost_date_input-${t}"]`).focus()}const b=g.target.closest(".delete-cost-form");b&&(g.preventDefault(),confirm("このコストを本当に削除しますか？")&&w.delete(b.action,{headers:{"X-CSRF-TOKEN":s,Accept:"application/json"}}).then(u=>{if(u.data.success){const x=`cost-row-${b.dataset.id}`,p=document.getElementById(x);p&&p.remove(),_(t,n),q(t),u.data.material_status_updated}else v(u,"削除に失敗しました。",f)}).catch(u=>{v(u.response,"削除中にエラーが発生しました。",f)}))}),c&&c.addEventListener("click",function(){_(t,n)}),o.addEventListener("submit",function(g){g.preventDefault();const l=document.getElementById(f);l&&(l.innerHTML="");const b=new FormData(o),u=o.getAttribute("action");let x="post";document.getElementById(`cost-form-method-${t}`).value==="PUT"&&b.append("_method","PUT"),w({method:x,url:u,data:b,headers:{"X-CSRF-TOKEN":s,Accept:"application/json"}}).then(p=>{if(p.data.success&&p.data.cost){const E=document.getElementById(`cost-form-method-${t}`).value==="PUT";U(t,p.data.cost,E,a),_(t,n),p.data.material_status_updated}else v(p,"コスト処理に失敗しました。",f)}).catch(p=>{v(p.response,"コスト送信中にエラーが発生しました。",f)})})}function N(){const e=document.getElementById("project-show-main-container");if(!e){console.error("[project-show-main.js] CRITICAL: mainContainer not found. Exiting initialization.");return}const t=e.dataset.projectId,s=k();let a={id:t};if(e.dataset.project)try{a=JSON.parse(e.dataset.project)}catch(n){console.error("[project-show-main.js] Failed to parse project data from HTML attribute:",n)}e.addEventListener("change",function(n){const d=n.target.closest(".project-flag-select, .project-status-select");d&&d.closest(".lg\\:col-span-1")&&H(d,s)}),e.querySelectorAll(".js-character-card").forEach(n=>{const d=n.querySelector('[id^="measurements-content-"]'),r=n.querySelector('[id^="materials-content-"]'),i=n.querySelector('[id^="costs-content-"]');let c=null;d?c=d.id.split("-").pop():r?c=r.id.split("-").pop():i&&(c=i.id.split("-").pop()),c?(d&&P(d,c,s,a),r&&R(r,c,s,a),i&&O(i,c,s,a)):console.warn("[project-show-main.js] Could not determine characterId for a character card. Skipping interactions init.",n)})}document.getElementById("project-show-main-container")&&N();
