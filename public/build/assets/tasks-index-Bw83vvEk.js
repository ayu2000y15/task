import{a as g}from"./app-BLFvNL6I.js";function S(s){switch(s){case"completed":return'<i class="fas fa-check-circle text-green-500" title="完了"></i>';case"in_progress":return'<i class="fas fa-play-circle text-blue-500" title="進行中"></i>';case"on_hold":return'<i class="fas fa-pause-circle text-yellow-500" title="保留中"></i>';case"cancelled":return'<i class="fas fa-times-circle text-red-500" title="キャンセル"></i>';case"not_started":default:return'<i class="far fa-circle text-gray-400" title="未着手"></i>'}}function h(s,r,t){if(!s)return;const i=s.querySelector(".task-status-icon-wrapper");if(i){let c=!1;if(s.tagName.toLowerCase()==="tr"){const n=s.querySelector("td:nth-child(2)");n&&(c=!!(n.querySelector("i.fa-flag")||n.querySelector("i.fa-folder")))}else s.tagName.toLowerCase()==="li"&&(c=!!(i.querySelector("i.fa-flag")||i.querySelector("i.fa-folder")));c||(i.innerHTML=S(r))}s.dataset.progress=t;const a=s.querySelector(".task-status-select");a&&(a.value=r,a.dataset.originalStatus=r,a.dataset.currentProgress=t)}function I(){document.querySelectorAll(".task-status-checkbox").forEach(s=>{s.addEventListener("change",function(){const r=this.closest("tr, li");if(!r)return;const t=r.dataset.taskId,i=r.dataset.projectId,a=this.dataset.action;if(!t||!i)return;const c=r.querySelector(".task-status-in-progress"),n=r.querySelector(".task-status-completed");let l="not_started",e=0,o=parseInt(r.dataset.progress||"0")||0;this.checked&&(a==="set-in-progress"&&n&&(n.checked=!1),a==="set-completed"&&c&&(c.checked=!1)),c!=null&&c.checked?(l="in_progress",e=o>0&&o<100?o:10):n!=null&&n.checked&&(l="completed",e=100),g.post(`/projects/${i}/tasks/${t}/progress`,{status:l,progress:e}).then(d=>{d.data.success&&h(r,l,e)})})})}function q(){document.querySelectorAll(".task-status-select").forEach(s=>{s.addEventListener("change",function(){var n;const r=this.dataset.taskId,t=this.dataset.projectId,i=this.value;let a=0,c=parseInt(((n=this.closest("tr, li"))==null?void 0:n.dataset.progress)||"0")||0;i==="completed"?a=100:i==="in_progress"&&(a=c>0&&c<100?c:10),g.post(`/projects/${t}/tasks/${r}/progress`,{status:i,progress:a}).then(l=>{if(l.data.success){const e=this.closest("tr, li");h(e,i,a);const o=e==null?void 0:e.querySelector(".task-status-in-progress"),d=e==null?void 0:e.querySelector(".task-status-completed");o&&(o.checked=i==="in_progress"),d&&(d.checked=i==="completed")}})})})}function E(){const s=document.getElementById("assignee-data-container");if(!s){console.warn("担当者選択肢のデータコンテナが見つかりません。");return}let r=[];try{r=JSON.parse(s.dataset.assigneeOptions)}catch(t){console.error("担当者選択肢のJSON解析に失敗しました。",t);return}document.querySelectorAll(".editable-cell-assignees").forEach(t=>{t.addEventListener("click",function(i){if(t.querySelector(".ts-control"))return;const a=t.closest("tr");if(!a)return;const c=a.dataset.taskId,n=a.dataset.projectId,l=JSON.parse(t.dataset.currentAssignees||"[]"),e=t.querySelector(".assignee-badge-container");e&&(e.style.display="none");const o=document.createElement("select");o.setAttribute("multiple","multiple"),t.appendChild(o);const d=new TomSelect(o,{options:r,items:l,valueField:"id",labelField:"name",searchField:"name",plugins:["remove_button"],create:!1,placeholder:"担当者を選択...",onBlur:function(){setTimeout(()=>{y(this)},150)}}),y=u=>{if(!u.wrapper)return;const p=u.items,m=[...l].sort(),k=[...p].sort();if(JSON.stringify(m)===JSON.stringify(k)){e&&(e.style.display="flex"),u.destroy(),o.remove();return}g.post(`/projects/${n}/tasks/${c}/assignee`,{assignees:p}).then(f=>{f.data.success?(e&&(e.innerHTML=f.data.assigneesHtml,e.style.display="flex"),t.dataset.currentAssignees=JSON.stringify(p)):(e&&(e.style.display="flex"),alert(f.data.message||"更新に失敗しました。"))}).catch(f=>{console.error("担当者の更新中にエラーが発生しました:",f),alert("担当者の更新中にエラーが発生しました。"),e&&(e.style.display="flex")}).finally(()=>{u.wrapper&&u.destroy(),o.parentNode&&o.remove()})};d.focus()})})}function v(){document.querySelectorAll(".toggle-folder-files").forEach(s=>{s.addEventListener("click",function(){const r=document.getElementById(this.dataset.target),t=this.querySelector("i");!r||!t||(r.classList.toggle("hidden"),t.classList.toggle("fa-chevron-down"),t.classList.toggle("fa-chevron-up"))})})}try{q(),I(),E(),v()}catch(s){console.error("Error during tasks-index.js specific initialization:",s)}
