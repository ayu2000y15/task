import{a as u}from"./app-C99uIeTS.js";const j={0:{tooltip:"未納品",icon:"fa-truck",colorClass:"text-yellow-500"},1:{tooltip:"納品済み",icon:"fa-check-circle",colorClass:"text-green-500"}},I={Pending:{tooltip:"未払い",icon:"fa-clock",colorClass:"text-yellow-500"},Processing:{tooltip:"支払い中",icon:"fa-spinner fa-spin",colorClass:"text-blue-500"},Completed:{tooltip:"支払完了",icon:"fa-check-circle",colorClass:"text-green-500"},"Partially Paid":{tooltip:"一部支払い",icon:"fa-adjust",colorClass:"text-orange-500"},Overdue:{tooltip:"期限切れ",icon:"fa-exclamation-triangle",colorClass:"text-red-500"},Cancelled:{tooltip:"キャンセル",icon:"fa-ban",colorClass:"text-gray-500"},Refunded:{tooltip:"返金済み",icon:"fa-undo",colorClass:"text-purple-500"},"On Hold":{tooltip:"保留中",icon:"fa-pause-circle",colorClass:"text-indigo-500"},"":{tooltip:"未設定",icon:"fa-question-circle",colorClass:"text-gray-400"}},m={not_started:{tooltip:"未着手",icon:"fa-minus-circle",colorClass:"text-gray-500"},in_progress:{tooltip:"進行中",icon:"fa-play-circle",colorClass:"text-blue-500"},completed:{tooltip:"完了",icon:"fa-check-circle",colorClass:"text-green-500"},on_hold:{tooltip:"保留中",icon:"fa-pause-circle",colorClass:"text-yellow-500"},cancelled:{tooltip:"キャンセル",icon:"fa-times-circle",colorClass:"text-red-500"},"":{tooltip:"未設定",icon:"fa-question-circle",colorClass:"text-gray-400"}};function g(t,c,o){if(t){const r=Object.keys(o).includes("")?"":Object.keys(o)[0],e=o[c]||o[r]||{tooltip:c||"-",icon:"fa-question-circle",colorClass:"text-gray-400"};t.title=e.tooltip;const a=t.querySelector("i");a?a.className=`fas ${e.icon} ${e.colorClass}`:t.innerHTML=`<i class="fas ${e.icon} ${e.colorClass}"></i>`}}function S(t,c){const o=t.dataset.projectId,r=t.dataset.url,e=t.value,a=t.name,s=t.dataset.iconTarget;if(!o||!r||!a){console.error("Update select element is missing required data attributes: projectId, url, or name.");return}const n={[a]:e};if(t.dataset.originalValueInitialized!=="true"){const i=Array.from(t.options).find(l=>l.selected);t.dataset.originalValue=i?i.value:"",t.dataset.originalValueInitialized="true"}const f=t.dataset.originalValue;u.patch(r,n,{headers:{"X-CSRF-TOKEN":c,Accept:"application/json"}}).then(i=>{if(i.data.success){t.dataset.originalValue=e;const l=document.getElementById(s);let d;if(a==="delivery_flag"?(d=j,g(l,i.data.delivery_flag,d)):a==="payment_flag"?(d=I,g(l,i.data.payment_flag,d)):a==="status"&&(d=m,g(l,i.data.new_status,d)),i.data.new_status){const y=document.getElementById(`project_status_icon_${o}`),p=document.getElementById(`project_status_select_${o}`);g(y,i.data.new_status,m),p&&(p.value=i.data.new_status,p.dataset.originalValue=i.data.new_status)}}else alert("更新に失敗しました: "+(i.data.message||"不明なエラー")),t.value=f}).catch(i=>{if(console.error("Error updating project flag/status:",i.response||i),alert("更新中にエラーが発生しました。"),t.value=f,i.response&&i.response.data&&i.response.data.errors){let l=[];for(const d in i.response.data.errors)l.push(i.response.data.errors[d].join(`
`));alert(`エラー詳細:
`+l.join(`
`))}})}function _(t,c,o){var s;const r=t.dataset.url,e=t.checked?"購入済":"未購入",a=(s=t.closest("[data-character-id]"))==null?void 0:s.dataset.characterId;if(!r||!a){console.error("Missing data attributes for material status update.");return}u.patch(r,{status:e},{headers:{"X-CSRF-TOKEN":o}}).then(n=>{n.data.success?h(c,a):(t.checked=!t.checked,alert("材料ステータスの更新に失敗しました: "+(n.data.message||"")))}).catch(n=>{console.error("Error updating material status:",n),t.checked=!t.checked,alert("材料ステータス更新中にエラーが発生しました。")})}function w(t,c,o){const r=t.dataset.characterId,e=new FormData(t);if(!r){console.error("Missing data attributes for cost form.");return}u.post(t.action,e,{headers:{"X-CSRF-TOKEN":o}}).then(a=>{a.status===200||a.status===201||a.data&&a.data.success?(h(c,r),t.reset()):C(a)}).catch(a=>{console.error("Error adding cost:",a.response||a),C(a.response,"コスト追加中にエラーが発生しました。")})}function x(t,c,o){var e;const r=(e=t.closest("[data-character-id]"))==null?void 0:e.dataset.characterId;if(!r){console.error("Missing data for cost deletion.");return}if(confirm("このコストを削除しますか？")){const a=new FormData(t);u.post(t.action,a,{headers:{"X-CSRF-TOKEN":o}}).then(s=>{s.status===200||s.data&&s.data.success?h(c,r):alert("コストの削除に失敗しました: "+(s.data.message||""))}).catch(s=>{console.error("Error deleting cost:",s),alert("コスト削除中にエラーが発生しました。")})}}function h(t,c){const o=document.getElementById(`costs-content-${c}`);if(!o){console.warn(`Could not find costs tab container for character: ${c}`);return}const r=`/projects/${t}/characters/${c}/costs-partial`;u.get(r).then(e=>{o.innerHTML=e.data}).catch(e=>{console.error("Error refreshing costs list:",e)})}function C(t,c="処理に失敗しました。"){let o=c;t&&t.data&&(t.data.message?o=t.data.message:t.data.errors&&(o=Object.values(t.data.errors).flat().join(`
`))),alert(o)}function k(){const t=document.getElementById("project-show-main-container");if(!t)return;const c=t.dataset.projectId,o=document.querySelector('meta[name="csrf-token"]');if(!o){console.error("CSRF token meta tag not found.");return}const r=o.getAttribute("content");t.addEventListener("change",function(e){const a=e.target.closest(".material-status-checkbox");if(a){_(a,c,r);return}const s=e.target.closest(".project-flag-select, .project-status-select");if(s){if(!s.dataset.originalValueInitialized){const n=Array.from(s.options).find(f=>f.selected);s.dataset.originalValue=n?n.value:"",s.dataset.originalValueInitialized="true"}S(s,r)}}),t.addEventListener("submit",function(e){const a=e.target.closest(".add-cost-form"),s=e.target.closest(".delete-cost-form");a?(e.preventDefault(),w(a,c,r)):s&&(e.preventDefault(),x(s,c,r))})}document.getElementById("project-show-main-container")&&k();
