import{a as p}from"./app-9G7k0uWa.js";function m(d){switch(d){case"completed":return'<i class="fas fa-check-circle text-green-500" title="完了"></i>';case"in_progress":return'<i class="fas fa-play-circle text-blue-500" title="進行中"></i>';case"on_hold":return'<i class="fas fa-pause-circle text-yellow-500" title="保留中"></i>';case"cancelled":return'<i class="fas fa-times-circle text-red-500" title="キャンセル"></i>';case"not_started":default:return'<i class="far fa-circle text-gray-400" title="未着手"></i>'}}function k(d,e,a){if(!d)return;const n=d.querySelector(".task-status-icon-wrapper");if(n){d.querySelector("td:nth-child(2)");const t=n.querySelector("i.fa-flag"),l=n.querySelector("i.fa-folder");!t&&!l&&(n.innerHTML=m(e))}d.dataset.progress=a;const o=d.querySelector(".task-status-select");o&&(o.value=e,o.dataset.originalStatus=e,o.dataset.currentProgress=a)}function y(){document.querySelectorAll(".task-status-checkbox").forEach(e=>{e.addEventListener("change",function(){const a=this.closest("tr");if(!a)return;const n=a.dataset.taskId,o=a.dataset.projectId,t=this.dataset.action,l=this.checked,r=a.querySelector(".task-status-in-progress"),s=a.querySelector(".task-status-completed");let i="not_started",f=0,c=parseInt(a.dataset.progress||"0");isNaN(c)&&(c=0),l&&(t==="set-in-progress"?s&&(s.checked=!1):t==="set-completed"&&r&&(r.checked=!1)),r&&r.checked?(i="in_progress",c>0&&c<100?f=c:c===100?f=90:f=10):s&&s.checked?(i="completed",f=100):(i="not_started",f=0);const u=r?r.checked:!1,g=s?s.checked:!1;r&&(r.checked=i==="in_progress"),s&&(s.checked=i==="completed"),p.post(`/projects/${o}/tasks/${n}/progress`,{status:i,progress:f}).then(h=>{h.data.success?k(a,i,f):(alert("更新に失敗: "+(h.data.message||"不明なエラー")),r&&(r.checked=u),s&&(s.checked=g))}).catch(h=>{console.error("Error updating task via checkbox:",h),alert("更新中にエラーが発生しました。"),r&&(r.checked=u),s&&(s.checked=g)})})})}function S(){document.querySelectorAll(".task-status-select").forEach(e=>{const a=e.closest("tr, li");a&&(e.dataset.originalStatus=e.value,e.dataset.currentProgress=a.dataset.progress||"0",e.addEventListener("change",function(){const n=this.dataset.taskId,o=this.dataset.projectId,t=this.value;let l=0,r=parseInt(this.dataset.currentProgress);isNaN(r)&&(r=0),t==="completed"?l=100:t==="not_started"||t==="cancelled"?l=0:t==="in_progress"?r===0?l=10:r===100?l=90:l=r>0?r:10:l=r,p.post(`/projects/${o}/tasks/${n}/progress`,{status:t,progress:l}).then(s=>{if(s.data.success){const i=this.closest("tr, li");if(i){k(i,t,l);const c=i.querySelector(".task-status-in-progress"),u=i.querySelector(".task-status-completed");c&&(c.checked=t==="in_progress"),u&&(u.checked=t==="completed")}!!document.querySelector("h2.text-xl")&&(t==="completed"||t==="cancelled")&&location.reload()}else alert("ステータスの更新に失敗しました: "+(s.data.message||"")),this.value=this.dataset.originalStatus||"not_started"}).catch(s=>{console.error("Error updating task status:",s),alert("ステータス更新中にエラーが発生しました。"),this.value=this.dataset.originalStatus||"not_started"})}))})}function v(){document.querySelectorAll('.editable-cell[data-field="assignee"]').forEach(e=>{if(!e.closest("tr"))return;const n=e.textContent.trim();e.dataset.originalValue=n==="-"?"":n,e.addEventListener("click",function(){if(this.querySelector("input.assignee-edit-input"))return;const t=this.dataset.originalValue||"",l=this.dataset.taskId,r=this.dataset.projectId;this.innerHTML=`<input type="text" value="${t}" class="assignee-edit-input form-input w-full text-sm p-1 border border-blue-500 rounded dark:bg-gray-700 dark:text-gray-200" placeholder="担当者名">`;const s=this.querySelector("input.assignee-edit-input");if(!s)return;s.focus(),s.select();const i=()=>{const c=e.querySelector("input.assignee-edit-input");if(!c)return;const u=c.value.trim();e.innerHTML=u||"-",e.dataset.originalValue=u,u!==t&&p.post(`/projects/${r}/tasks/${l}/assignee`,{assignee:u}).then(g=>{g.data.success||(e.innerHTML=t||"-",e.dataset.originalValue=t,alert("担当者の更新に失敗しました: "+(g.data.message||"")))}).catch(g=>{console.error("Error updating assignee:",g),e.innerHTML=t||"-",e.dataset.originalValue=t,alert("担当者更新中にエラーが発生しました。")}),c.removeEventListener("blur",i)},f=c=>{if(c.key==="Enter")c.preventDefault(),i();else if(c.key==="Escape"){const u=e.querySelector("input.assignee-edit-input");u&&(u.value=t),i()}};s.addEventListener("blur",i,{once:!0}),s.addEventListener("keydown",f)})})}function x(){document.querySelectorAll(".toggle-folder-files").forEach(e=>{const a=e.dataset.target;a&&e.addEventListener("click",function(){const n=document.getElementById(a),o=this.querySelector("i");n&&(n.classList.toggle("hidden"),n.classList.contains("hidden")?(o.classList.remove("fa-chevron-up"),o.classList.add("fa-chevron-down")):(o.classList.remove("fa-chevron-down"),o.classList.add("fa-chevron-up")))})})}try{S(),y(),v(),x()}catch(d){console.error("Error during tasks-index.js specific initialization:",d)}const E={};export{E as default};
