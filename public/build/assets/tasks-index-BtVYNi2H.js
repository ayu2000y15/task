import{a as g}from"./app-D0orqVx1.js";function h(a){switch(a){case"completed":return'<i class="fas fa-check-circle text-green-500" title="完了"></i>';case"in_progress":return'<i class="fas fa-play-circle text-blue-500" title="進行中"></i>';case"on_hold":return'<i class="fas fa-pause-circle text-yellow-500" title="保留中"></i>';case"cancelled":return'<i class="fas fa-times-circle text-red-500" title="キャンセル"></i>';case"not_started":default:return'<i class="far fa-circle text-gray-400" title="未着手"></i>'}}function m(a,e,n){if(!a)return;const r=a.querySelector(".task-status-icon-wrapper");if(r){const t=a.querySelector("td:nth-child(2)");t&&t.querySelector("i.fa-flag")||t&&t.querySelector("i.fa-folder")||(r.innerHTML=h(e))}const i=a.querySelector(".task-status-select");i&&(i.dataset.originalStatus=e,i.dataset.currentProgress=n)}function y(){document.querySelectorAll(".task-status-select").forEach(e=>{const n=e.closest("tr, li");n&&(e.dataset.originalStatus=e.value,e.dataset.currentProgress=n.dataset.progress||"0",e.addEventListener("change",function(){const r=this.dataset.taskId,i=this.dataset.projectId,t=this.value;let o=0;if(t==="completed")o=100;else if(t==="not_started"||t==="cancelled")o=0;else if(t==="in_progress"){let s=parseInt(this.dataset.currentProgress);isNaN(s)&&(s=0),s===0&&t==="in_progress"?o=10:s===100&&t==="in_progress"?o=90:o=s>0?s:10}g.post(`/projects/${i}/tasks/${r}/progress`,{status:t,progress:o}).then(s=>{if(s.data.success)if(!!document.querySelector("h2.text-xl"))location.reload();else{const c=this.closest("tr, li");c&&m(c,t,o)}else alert("ステータスの更新に失敗しました: "+(s.data.message||"")),this.value=this.dataset.originalStatus||"not_started"}).catch(s=>{console.error("Error updating task status:",s),alert("ステータス更新中にエラーが発生しました。"),this.value=this.dataset.originalStatus||"not_started"})}))})}function k(){document.querySelectorAll('.editable-cell[data-field="assignee"]').forEach(e=>{if(!e.closest("tr"))return;const r=e.textContent.trim();e.dataset.originalValue=r==="-"?"":r,e.addEventListener("click",function(){if(this.querySelector("input.assignee-edit-input"))return;const t=this.dataset.originalValue||"",o=this.dataset.taskId,s=this.dataset.projectId;this.innerHTML=`<input type="text" value="${t}" class="assignee-edit-input form-input w-full text-sm p-1 border border-blue-500 rounded dark:bg-gray-700 dark:text-gray-200" placeholder="担当者名">`;const d=this.querySelector("input.assignee-edit-input");if(!d)return;d.focus(),d.select();const c=()=>{const l=e.querySelector("input.assignee-edit-input");if(!l)return;const u=l.value.trim();e.innerHTML=u||"-",e.dataset.originalValue=u,u!==t&&g.post(`/projects/${s}/tasks/${o}/assignee`,{assignee:u}).then(f=>{f.data.success||(e.innerHTML=t||"-",e.dataset.originalValue=t,alert("担当者の更新に失敗しました: "+(f.data.message||"")))}).catch(f=>{console.error("Error updating assignee:",f),e.innerHTML=t||"-",e.dataset.originalValue=t,alert("担当者更新中にエラーが発生しました。")}),l.removeEventListener("blur",c)},p=l=>{if(l.key==="Enter")l.preventDefault(),c();else if(l.key==="Escape"){const u=e.querySelector("input.assignee-edit-input");u&&(u.value=t),c()}};d.addEventListener("blur",c,{once:!0}),d.addEventListener("keydown",p)})})}function v(){document.querySelectorAll(".toggle-folder-files").forEach(e=>{const n=e.dataset.target;if(!n){console.warn("FolderFileToggle: Button found without data-target attribute.");return}e.addEventListener("click",function(){const r=document.getElementById(n),i=this.querySelector("i");if(!r){console.warn("FolderFileToggle: Target element not found with ID:",n);return}r.classList.toggle("hidden"),r.classList.contains("hidden")?(i.classList.remove("fa-chevron-up"),i.classList.add("fa-chevron-down")):(i.classList.remove("fa-chevron-down"),i.classList.add("fa-chevron-up"))})})}try{y(),k(),v()}catch(a){console.error("Error during tasks-index.js specific initialization:",a)}const E={};export{E as default};
