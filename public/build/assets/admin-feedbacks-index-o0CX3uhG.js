import{a as D}from"./app-CMK6dsaR.js";const F={unread:"未読",not_started:"未着手",in_progress:"対応中",completed:"対応済み",cancelled:"キャンセル",on_hold:"保留"};function R(y){switch(y){case"unread":return"bg-gray-200 text-gray-700 dark:bg-gray-600 dark:text-gray-200";case"not_started":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-700 dark:text-blue-100";case"completed":return"bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-700 dark:text-red-100";case"on_hold":return"bg-indigo-100 text-indigo-800 dark:bg-indigo-700 dark:text-indigo-100";default:return"bg-gray-100 text-gray-700 dark:bg-gray-500 dark:text-gray-300"}}function h(){const y=document.getElementById("feedback-table");if(!y)return;const L=document.querySelector('meta[name="csrf-token"]').getAttribute("content");y.addEventListener("change",function(f){var p,g;if(f.target.classList.contains("feedback-status-select")){const o=f.target,_=((p=o.closest(".status-cell"))==null?void 0:p.dataset.feedbackId)||((g=o.closest("tr.feedback-main-row"))==null?void 0:g.dataset.feedbackId),v=o.dataset.url,E=o.value,m=o.dataset.originalStatus;if(!v||!_){console.error("Status Update: Missing data attributes (feedbackId or url). FID:",_,"URL:",v);return}D.patch(v,{status:E},{headers:{"X-CSRF-TOKEN":L,Accept:"application/json"}}).then(t=>{if(t.data.success&&t.data.feedback){const d=t.data.feedback;o.dataset.originalStatus=d.status;const i=o.closest(".status-cell").querySelector(".status-badge");i&&(i.textContent=d.status_label_display||F[d.status]||d.status,i.className=`status-badge px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${d.status_badge_class_display||R(d.status)}`);const r=document.getElementById(`feedback-row-${_}`),e=r?r.nextElementSibling:null;if(e&&e.classList.contains("details-row")&&e.style.display!=="none"){const a=e.querySelector(".feedback-completed-at-display");a&&(a.textContent=d.completed_at_display||"-");const s=e.querySelector(".feedback-updated-at-cell");s&&(s.textContent=d.updated_at_display||"-")}window.dispatchEvent(new CustomEvent("feedback-status-updated"))}else alert("ステータスの更新に失敗しました: "+(t.data.message||"不明なエラー")),o.value=m}).catch(t=>{console.error("Error updating status:",t.response||t),alert("ステータス更新中にエラーが発生しました。"),o.value=m})}});function q(f,p,g,o,_,v,E,m,t){y.addEventListener("click",function(d){const l=d.target.closest(`.${p}`);if(l){const e=l.closest(`.${f}`);if(e&&e.contains(l)&&!e.classList.contains("editing")){const a=e.querySelector(`.${g}`),s=a.querySelector(o),k=l.dataset[m]||"";e.classList.add("editing"),l.style.display="none",a.style.display="block",s.value=k,s.focus(),s.dataset.originalValue=k}}const i=d.target.closest(`.${_}`);if(i){d.preventDefault();const e=i.closest(`.${g}`),a=e.closest(`.${f}`),s=a.querySelector(`.${p}`),k=e.querySelector(o),n=a.dataset.feedbackId,u=a.dataset[E],w=k.value;if(!n||!u){console.error(`Missing data attributes for ${t} update. FID: ${n}, URL: ${u}`),e.style.display="none",s.style.display="block",a.classList.remove("editing");return}D.patch(u,{[t]:w},{headers:{"X-CSRF-TOKEN":L,Accept:"application/json"}}).then(c=>{if(c.data.success&&c.data.feedback){const S=c.data.feedback,b=S[t]||"",x=t==="admin_memo"&&b.length>50?b.substring(0,50)+"...":b||"-";s.textContent=x,s.dataset[m]=b,s.title=b||"クリックして編集";const $=document.getElementById(`feedback-row-${n}`),I=$?$.nextElementSibling:null;if(I&&I.classList.contains("details-row")&&I.style.display!=="none"){const T=I.querySelector(".feedback-updated-at-cell");T&&S.updated_at_display&&(T.textContent=S.updated_at_display)}window.dispatchEvent(new CustomEvent("feedback-status-updated"))}else alert(`${t==="admin_memo"?"メモ":"担当者"}の更新に失敗しました: `+(c.data.message||"不明なエラー"))}).catch(c=>{console.error(`Error updating ${t}:`,c.response||c),alert(`${t==="admin_memo"?"メモ":"担当者"}更新中にエラーが発生しました。`)}).finally(()=>{e.style.display="none",s.style.display="block",a.classList.remove("editing")})}const r=d.target.closest(`.${v}`);if(r){d.preventDefault();const e=r.closest(`.${g}`),a=e.closest(`.${f}`),s=a.querySelector(`.${p}`);e.style.display="none",s.style.display="block",a.classList.remove("editing")}}),y.addEventListener("focusout",function(d){const l=d.target;if(l.matches(o)&&l.closest(`.${g}`)){const i=l.closest(`.${f}`);setTimeout(()=>{const r=l.closest(`.${g}`);if(r&&r.style.display==="block"&&!r.contains(document.activeElement)){const e=i.querySelector(`.${p}`),a=i.dataset.feedbackId,s=i.dataset[E],k=l.value,n=l.dataset.originalValue;if(!a||!s){console.error(`Missing data attributes for ${t} auto-save.`),r.style.display="none",e.style.display="block",i.classList.remove("editing");return}k!==n&&D.patch(s,{[t]:k},{headers:{"X-CSRF-TOKEN":L,Accept:"application/json"}}).then(u=>{if(u.data.success&&u.data.feedback){const w=u.data.feedback,c=w[t]||"",S=t==="admin_memo"&&c.length>50?c.substring(0,50)+"...":c||"-";e.textContent=S,e.dataset[m]=c,e.title=c||"クリックして編集";const b=document.getElementById(`feedback-row-${a}`),x=b?b.nextElementSibling:null;if(x&&x.classList.contains("details-row")&&x.style.display!=="none"){const $=x.querySelector(".feedback-updated-at-cell");$&&w.updated_at_display&&($.textContent=w.updated_at_display)}window.dispatchEvent(new CustomEvent("feedback-status-updated"))}else e.textContent=n?t==="admin_memo"&&n.length>50?n.substring(0,50)+"...":n:"-",e.dataset[m]=n||"",e.title=n||"クリックして編集",alert(`${t==="admin_memo"?"メモ":"担当者"}の自動保存に失敗しました: `+(u.data.message||"不明なエラー"))}).catch(u=>{console.error(`Error auto-saving ${t}:`,u.response||u),e.textContent=n?t==="admin_memo"&&n.length>50?n.substring(0,50)+"...":n:"-",e.dataset[m]=n||"",e.title=n||"クリックして編集",alert(`${t==="admin_memo"?"メモ":"担当者"}の自動保存中にエラーが発生しました。`)}),r.style.display="none",e.style.display="block",i.classList.remove("editing")}},150)}})}q("memo-cell","memo-display","memo-editing","textarea","memo-save-btn","memo-cancel-btn","memoUrl","fullMemo","admin_memo"),q("assignee-cell","assignee-display","assignee-editing",'input[type="text"]',"assignee-save-btn","assignee-cancel-btn","assigneeUrl","fullAssignee","assignee_text")}document.getElementById("feedback-table")&&h();const B={initializeAdminFeedbacksPage:h};export{B as default};
