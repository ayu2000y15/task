import{a as w}from"./app-B5Hc5jfW.js";const F={0:{tooltip:"未納品",icon:"fa-truck",colorClass:"text-yellow-500 dark:text-yellow-400"},1:{tooltip:"納品済み",icon:"fa-check-circle",colorClass:"text-green-500 dark:text-green-400"}},M={Pending:{tooltip:"未払い",icon:"fa-clock",colorClass:"text-yellow-500 dark:text-yellow-400"},Processing:{tooltip:"支払い中",icon:"fa-hourglass-half",colorClass:"text-blue-500 dark:text-blue-400"},Completed:{tooltip:"支払完了",icon:"fa-check-circle",colorClass:"text-green-500 dark:text-green-400"},"Partially Paid":{tooltip:"一部支払い",icon:"fa-adjust",colorClass:"text-orange-500 dark:text-orange-400"},Overdue:{tooltip:"期限切れ",icon:"fa-exclamation-triangle",colorClass:"text-red-500 dark:text-red-400"},Cancelled:{tooltip:"キャンセル",icon:"fa-ban",colorClass:"text-gray-500 dark:text-gray-400"},Refunded:{tooltip:"返金済み",icon:"fa-undo",colorClass:"text-purple-500 dark:text-purple-400"},"On Hold":{tooltip:"保留中",icon:"fa-pause-circle",colorClass:"text-indigo-500 dark:text-indigo-400"},"":{tooltip:"未設定",icon:"fa-question-circle",colorClass:"text-gray-400 dark:text-gray-500"}},L={not_started:{tooltip:"未着手",icon:"fa-minus-circle",colorClass:"text-gray-500 dark:text-gray-400"},in_progress:{tooltip:"進行中",icon:"fa-play-circle",colorClass:"text-blue-500 dark:text-blue-400"},completed:{tooltip:"完了",icon:"fa-check-circle",colorClass:"text-green-500 dark:text-green-400"},on_hold:{tooltip:"保留中",icon:"fa-pause-circle",colorClass:"text-yellow-500 dark:text-yellow-400"},cancelled:{tooltip:"キャンセル",icon:"fa-times-circle",colorClass:"text-red-500 dark:text-red-400"},"":{tooltip:"未設定",icon:"fa-question-circle",colorClass:"text-gray-400 dark:text-gray-500"}};function S(e,t,n){if(e){const l=Object.keys(n).includes("")?"":Object.keys(n)[0],o=n[t]||n[l]||{tooltip:t||"-",icon:"fa-question-circle",colorClass:"text-gray-400 dark:text-gray-500"};e.title=o.tooltip;const s=e.querySelector("i");if(s){const d=Array.from(s.classList).filter(i=>i.startsWith("fa-")||i.startsWith("text-")||i.startsWith("dark:text-"));s.classList.remove(...d);const r=o.icon.split(" ");s.classList.add("fas",...r),o.colorClass&&o.colorClass.split(" ").forEach(i=>s.classList.add(i))}else e.innerHTML=`<i class="fas ${o.icon} ${o.colorClass||""}"></i>`}}function H(e,t){e.dataset.projectId;const n=e.name,l=e.value,o=e.dataset.url,s=e.dataset.iconTarget,d=document.getElementById(s);w.patch(o,{[n]:l},{headers:{"X-CSRF-TOKEN":t,Accept:"application/json","Content-Type":"application/json"}}).then(r=>{if(r.data.success){if(d){let i;n==="delivery_flag"?i=F:n==="payment_flag"?i=M:n==="status"&&(i=L),i&&S(d,l,i)}if(r.data.updated_project_status!==void 0){const i=e.dataset.statusTargetSelect,c=e.dataset.statusTargetIcon;if(i){const m=document.getElementById(i);m&&(m.value=r.data.updated_project_status)}if(c){const m=document.getElementById(c);m&&S(m,r.data.updated_project_status,L)}}}else alert("更新に失敗しました: "+(r.data.message||"サーバーエラー"))}).catch(r=>{let i="更新中にエラーが発生しました。";r.response&&r.response.data&&r.response.data.message?i+=`
`+r.response.data.message:r.response&&r.response.status&&(i+=` (ステータス: ${r.response.status})`),alert(i)})}function v(e,t="処理に失敗しました。",n=null){let l=t,o=null;if(e&&e.data){if(e.data.message&&(typeof e.data.message!="object"||Object.keys(e.data.message).length>0)&&(l=e.data.message),e.data.errors){o=e.data.errors;let d=[];for(const r in o)d.push(o[r].join("; "));d.length>0&&l===t&&(l=d.join(`
`))}}else e&&typeof e=="string"&&(l=e);const s=n?document.getElementById(n):null;if(s&&o){let d='<ul class="list-disc pl-5 text-red-600 dark:text-red-400">';for(const i in o)o[i].forEach(c=>{d+=`<li>${$(c)}</li>`});d+="</ul>",s.innerHTML=d;const r=s.closest("form");r&&Object.keys(o).forEach(i=>{const c=i.includes(".")?i.split(".").map((y,f)=>f===0?y:`[${y}]`).join(""):i,m=r.querySelector(`[name="${c}"], [name="${c}[]"]`);m&&m.classList.add("border-red-500","dark:border-red-600")})}else s&&l?s.innerHTML=`<p class="text-red-600 dark:text-red-400">${k($(String(l)))}</p>`:l&&!s&&alert(String(l))}function h(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):null}function $(e){return e===null||typeof e>"u"?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function k(e){return typeof e>"u"||e===null?"":String(e).replace(/(\r\n|\n\r|\r|\n)/g,"<br>$1")}function B(e,t){const n=document.getElementById(`costs-content-${t}`);if(!n){console.warn(`Could not find costs tab container for character: ${t}`);return}const l=`/projects/${e}/characters/${t}/costs-partial`;w.get(l).then(o=>{n.innerHTML=o.data}).catch(o=>{console.error("Error refreshing costs list:",o),n.innerHTML='<p class="text-red-500 p-4">コスト情報の更新に失敗しました。</p>'})}function T(e,t){const n=document.getElementById(`measurement-form-${e}`);if(!n){console.warn(`Measurement form not found for reset: measurement-form-${e}`);return}n.reset(),n.setAttribute("action",t);const l=document.getElementById(`measurement-form-method-${e}`);l&&(l.value="POST");const o=document.getElementById(`measurement-form-id-${e}`);o&&(o.value="");const s=document.getElementById(`measurement-form-title-${e}`);s&&(s.textContent="採寸データを追加");const d=document.getElementById(`measurement-form-submit-btn-text-${e}`);d&&(d.textContent="追加");const r=document.getElementById(`measurement-form-submit-btn-${e}`);r&&(r.classList.remove("bg-yellow-500","hover:bg-yellow-600","active:bg-yellow-700","focus:border-yellow-700","focus:ring-yellow-300"),r.classList.add("bg-green-500","hover:bg-green-600","active:bg-green-700","focus:border-green-700","focus:ring-green-300"));const i=document.getElementById(`measurement-form-cancel-btn-${e}`);i&&(i.style.display="none");const c=document.getElementById(`measurement-form-errors-${e}`);c&&(c.innerHTML=""),n.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(m=>{m.classList.remove("border-red-500","dark:border-red-600")})}function A(e,t,n,l){const o=document.querySelector(`#measurements-content-${e} table tbody`);if(!o){console.warn(`Measurement table body not found for character ${e}`);return}const s=document.getElementById(`measurement-row-${t.id}`),d=t.notes?k($(t.notes)):"-",r=h();let i='<div class="flex items-center justify-end space-x-1">';i+=`
        <button type="button" class="p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 edit-measurement-btn"
                title="編集"
                data-id="${t.id}"
                data-item="${$(t.item||"")}"
                data-value="${$(t.value||"")}"
                data-notes="${$(t.notes||"")}">
            <i class="fas fa-edit fa-sm"></i>
        </button>`,i+=`
        <form action="/projects/${l.id}/characters/${e}/measurements/${t.id}"
              method="POST" class="delete-measurement-form"
              data-id="${t.id}"
              onsubmit="return false;">
            <input type="hidden" name="_token" value="${r}">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit"
                class="p-1 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"
                title="削除">
                <i class="fas fa-trash fa-sm"></i>
            </button>
        </form>`,i+="</div>";const c=`
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 measurement-item">${$(t.item)}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 measurement-value">${$(t.value)}</td>
        <td class="px-4 py-1.5 text-gray-700 dark:text-gray-200 whitespace-pre-wrap break-words text-left leading-tight measurement-notes" style="min-width: 150px;">
            ${d}
        </td>
        <td class="px-3 py-1.5 whitespace-nowrap text-right">
            ${i}
        </td>
    `;if(n&&s)s.innerHTML=c;else if(!n){const m=document.createElement("tr");m.id=`measurement-row-${t.id}`,m.classList.add("hover:bg-gray-50","dark:hover:bg-gray-700/50"),m.innerHTML=c;const y=o.querySelector('td[colspan="4"]');y&&y.parentElement.remove(),o.appendChild(m)}}function P(e,t,n,l){const o=document.getElementById(`measurement-form-${t}`);if(!o){console.warn(`Measurement form not found for character ${t}`);return}const s=o.dataset.storeUrl,d=document.getElementById(`measurement-form-title-${t}`),r=document.getElementById(`measurement-form-submit-btn-${t}`),i=document.getElementById(`measurement-form-submit-btn-text-${t}`),c=document.getElementById(`measurement-form-cancel-btn-${t}`),m=document.getElementById(`measurement-form-method-${t}`),y=document.getElementById(`measurement-form-id-${t}`),f=`measurement-form-errors-${t}`;e.addEventListener("click",function(g){const a=g.target.closest(".edit-measurement-btn");if(a){g.preventDefault(),d&&(d.textContent="採寸データを編集"),o.setAttribute("action",`/projects/${l.id}/characters/${t}/measurements/${a.dataset.id}`),m&&(m.value="PUT"),y&&(y.value=a.dataset.id);const u=o.querySelector(`[id="measurement_item_input-${t}"]`),x=o.querySelector(`[id="measurement_value_input-${t}"]`),p=o.querySelector(`[id="measurement_notes_input-${t}"]`);u&&(u.value=a.dataset.item),x&&(x.value=a.dataset.value),p&&(p.value=a.dataset.notes||""),i&&(i.textContent="更新"),r&&(r.classList.remove("bg-green-500","hover:bg-green-600"),r.classList.add("bg-yellow-500","hover:bg-yellow-600")),c&&(c.style.display="inline-flex");const E=document.getElementById(f);E&&(E.innerHTML=""),u&&u.focus()}const b=g.target.closest(".delete-measurement-form");b&&(g.preventDefault(),confirm("この採寸データを本当に削除しますか？")&&w.delete(b.action,{headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).then(u=>{if(u.data.success){const x=`measurement-row-${b.dataset.id}`,p=document.getElementById(x);p&&p.remove(),T(t,s)}else v(u,"削除に失敗しました。",f)}).catch(u=>{v(u.response,"削除中にエラーが発生しました。",f)}))}),c&&c.addEventListener("click",function(){T(t,s)}),o.addEventListener("submit",function(g){g.preventDefault();const a=document.getElementById(f);a&&(a.innerHTML="");const b=new FormData(o),u=o.getAttribute("action");let x="post";document.getElementById(`measurement-form-method-${t}`).value==="PUT"&&b.append("_method","PUT"),w({method:x,url:u,data:b,headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).then(p=>{if(p.data.success&&p.data.measurement){const E=document.getElementById(`measurement-form-method-${t}`).value==="PUT";A(t,p.data.measurement,E,l),T(t,s)}else v(p,"処理に失敗しました。",f)}).catch(p=>{v(p.response,"送信中にエラーが発生しました。",f)})})}function C(e,t){const n=document.getElementById(`material-form-${e}`);if(!n){console.warn(`Material form not found for reset: material-form-${e}`);return}n.reset(),n.setAttribute("action",t);const l=document.getElementById(`material-form-method-${e}`);l&&(l.value="POST");const o=document.getElementById(`material-form-id-${e}`);o&&(o.value="");const s=document.getElementById(`material-form-title-${e}`);s&&(s.textContent="材料を追加");const d=document.getElementById(`material-form-submit-btn-text-${e}`);d&&(d.textContent="追加");const r=document.getElementById(`material-form-submit-btn-${e}`);r&&(r.classList.remove("bg-yellow-500","hover:bg-yellow-600","active:bg-yellow-700","focus:border-yellow-700","focus:ring-yellow-300"),r.classList.add("bg-green-500","hover:bg-green-600","active:bg-green-700","focus:border-green-700","focus:ring-green-300"));const i=document.getElementById(`material-form-cancel-btn-${e}`);i&&(i.style.display="none");const c=document.getElementById(`material-form-errors-${e}`);c&&(c.innerHTML=""),n.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(m=>{m.classList.remove("border-red-500","dark:border-red-600")})}function j(e,t,n,l){const o=document.querySelector(`#materials-content-${e} table tbody`);if(!o){console.warn(`Material table body not found for character ${e}`);return}const s=document.getElementById(`material-row-${t.id}`),d=t.notes?k($(t.notes)):"-",r=t.price!==null?Number(t.price).toLocaleString()+"円":"-",i=h(),c=`/projects/${l.id}/characters/${e}/materials/${t.id}`;let m='<div class="flex items-center justify-end space-x-1">';m+=`
        <button type="button" class="p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 edit-material-btn"
                title="編集"
                data-id="${t.id}"
                data-name="${$(t.name||"")}"
                data-price="${t.price||""}"
                data-quantity_needed="${$(t.quantity_needed||"")}"
                data-notes="${$(t.notes||"")}">
            <i class="fas fa-edit fa-sm"></i>
        </button>`,m+=`
        <form action="/projects/${l.id}/characters/${e}/materials/${t.id}"
              method="POST" class="delete-material-form"
              data-id="${t.id}"
              onsubmit="return false;">
            <input type="hidden" name="_token" value="${i}">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit"
                class="p-1 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"
                title="削除">
                <i class="fas fa-trash fa-sm"></i>
            </button>
        </form>`,m+="</div>";const f=`
        <td class="px-3 py-1.5 whitespace-nowrap">
            ${`
        <input type="checkbox"
            id="material-status-checkbox-${t.id}"
            class="form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:bg-gray-900 dark:border-gray-600 material-status-checkbox"
            data-url="${c}"
            data-id="${t.id}" data-character-id="${e}"
            ${t.status==="購入済"?"checked":""}>`}
        </td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 material-name">${$(t.name)}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 material-price">${r}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 material-quantity_needed">${$(t.quantity_needed)}</td>
        <td class="px-4 py-1.5 text-gray-700 dark:text-gray-200 whitespace-pre-wrap break-words text-left leading-tight material-notes" style="min-width: 150px;">
            ${d}
        </td>
        <td class="px-3 py-1.5 whitespace-nowrap text-right">
            ${m}
        </td>
    `;if(n&&s)s.innerHTML=f;else if(!n){const g=document.createElement("tr");g.id=`material-row-${t.id}`,g.classList.add("hover:bg-gray-50","dark:hover:bg-gray-700/50"),g.innerHTML=f;const a=o.querySelector('td[colspan="6"]');a&&a.parentElement.remove(),o.appendChild(g)}}function R(e,t,n,l){const o=document.getElementById(`material-form-${t}`);if(!o){console.warn(`Material form not found for character ${t}. Aborting init for this character's materials.`);return}const s=o.dataset.storeUrl,d=document.getElementById(`material-form-title-${t}`),r=document.getElementById(`material-form-submit-btn-${t}`),i=document.getElementById(`material-form-submit-btn-text-${t}`),c=document.getElementById(`material-form-cancel-btn-${t}`),m=document.getElementById(`material-form-method-${t}`),y=document.getElementById(`material-form-id-${t}`),f=`material-form-errors-${t}`;e.addEventListener("click",function(g){const a=g.target.closest(".edit-material-btn");if(a){g.preventDefault(),d&&(d.textContent="材料を編集"),o.setAttribute("action",`/projects/${l.id}/characters/${t}/materials/${a.dataset.id}`),m&&(m.value="PUT"),y&&(y.value=a.dataset.id),o.elements.name.value=a.dataset.name,o.elements.price.value=a.dataset.price||"",o.elements.quantity_needed.value=a.dataset.quantity_needed,o.elements.notes.value=a.dataset.notes||"",i&&(i.textContent="更新"),r&&(r.classList.remove("bg-green-500","hover:bg-green-600"),r.classList.add("bg-yellow-500","hover:bg-yellow-600")),c&&(c.style.display="inline-flex");const u=document.getElementById(f);u&&(u.innerHTML=""),o.elements.name.focus()}const b=g.target.closest(".delete-material-form");b&&(g.preventDefault(),confirm("この材料を本当に削除しますか？")&&w.delete(b.action,{headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).then(u=>{if(u.data.success){const x=`material-row-${b.dataset.id}`,p=document.getElementById(x);p&&p.remove(),C(t,s),u.data.costs_updated&&B(l.id,t)}else v(u,"削除に失敗しました。",f)}).catch(u=>{v(u.response,"削除中にエラーが発生しました。",f)}))}),c&&c.addEventListener("click",function(){C(t,s)}),o.addEventListener("submit",function(g){g.preventDefault();const a=document.getElementById(f);a&&(a.innerHTML="");const b=new FormData(o),u=o.getAttribute("action");let x="post";document.getElementById(`material-form-method-${t}`).value==="PUT"&&b.append("_method","PUT"),w({method:x,url:u,data:b,headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).then(p=>{if(p.data.success&&p.data.material){const E=document.getElementById(`material-form-method-${t}`).value==="PUT";j(t,p.data.material,E,l),C(t,s),p.data.costs_updated&&B(l.id,t)}else v(p,"処理に失敗しました。",f)}).catch(p=>{v(p.response,"送信中にエラーが発生しました。",f)})}),e.addEventListener("change",function(g){const a=g.target.closest(".material-status-checkbox");if(a&&a.dataset.characterId===t){a.dataset.id;const b=a.checked?"購入済":"未購入",u=a.dataset.url;w.put(u,{status:b},{headers:{"X-CSRF-TOKEN":n,Accept:"application/json","Content-Type":"application/json"}}).then(x=>{x.data.success&&x.data.material?(j(t,x.data.material,!0,l),x.data.costs_updated&&B(l.id,t)):(v(x,"ステータス更新に失敗しました。",f),a.checked=!a.checked)}).catch(x=>{v(x.response,"ステータス更新中にエラーが発生しました。",f),a.checked=!a.checked})}})}function q(e){const t=document.getElementById(`costs-content-${e}`);if(!t)return;const n=t.querySelector("table tbody");if(!n)return;let l=0;n.querySelectorAll('tr[id^="cost-row-"]').forEach(s=>{const d=s.querySelector(".cost-amount");d&&(l+=parseFloat(String(d.textContent).replace(/[^0-9.-]+/g,""))||0)});const o=t.querySelector(".p-3.rounded-md span.font-semibold");if(o){o.textContent=Number(l).toLocaleString()+"円";const s=o.closest(".p-3.rounded-md");s&&(l>0?(s.classList.remove("bg-gray-100","text-gray-700","dark:bg-gray-700/30","dark:text-gray-300"),s.classList.add("bg-green-100","text-green-700","dark:bg-green-700/30","dark:text-green-200")):(s.classList.remove("bg-green-100","text-green-700","dark:bg-green-700/30","dark:text-green-200"),s.classList.add("bg-gray-100","text-gray-700","dark:bg-gray-700/30","dark:text-gray-300")))}}function _(e,t){const n=document.getElementById(`cost-form-${e}`);if(!n)return;n.reset(),n.setAttribute("action",t);const l=document.getElementById(`cost-form-method-${e}`);l&&(l.value="POST");const o=document.getElementById(`cost-form-id-${e}`);o&&(o.value="");const s=document.getElementById(`cost-form-title-${e}`);s&&(s.textContent="コストを追加");const d=document.getElementById(`cost-form-submit-btn-text-${e}`);d&&(d.textContent="追加");const r=document.getElementById(`cost-form-submit-btn-${e}`);r&&(r.classList.remove("bg-yellow-500","hover:bg-yellow-600","active:bg-yellow-700","focus:border-yellow-700","focus:ring-yellow-300"),r.classList.add("bg-green-500","hover:bg-green-600","active:bg-green-700","focus:border-green-700","focus:ring-green-300"));const i=document.getElementById(`cost-form-cancel-btn-${e}`);i&&(i.style.display="none");const c=document.getElementById(`cost-form-errors-${e}`);c&&(c.innerHTML=""),n.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(y=>{y.classList.remove("border-red-500","dark:border-red-600")});const m=n.querySelector(`#cost_cost_date_input-${e}`)||n.querySelector('[id^="cost_cost_date_input"]');if(m&&!(o&&o.value)){const y=new Date,f=y.getFullYear(),g=String(y.getMonth()+1).padStart(2,"0"),a=String(y.getDate()).padStart(2,"0");m.value=`${f}-${g}-${a}`}}function U(e,t,n,l){const o=document.querySelector(`#costs-content-${e} table tbody`);if(!o)return;const s=document.getElementById(`cost-row-${t.id}`),d=t.notes?k($(t.notes)):"-",r=Number(t.amount).toLocaleString()+"円";let i="-";if(t.cost_date&&typeof t.cost_date=="string"){const a=new Date(t.cost_date);isNaN(a.getTime())?i="日付エラー":i=a.toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"Asia/Tokyo"})}else i="日付なし";const c=h();let m="",y="bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-100";t.type==="材料費"?y="bg-blue-100 text-blue-800 dark:bg-blue-700 dark:text-blue-100":t.type==="作業費"&&(y="bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100"),m=`<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y}">${$(t.type)}</span>`;let f='<div class="flex items-center justify-end space-x-1">';f+=`
        <button type="button" class="p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 edit-cost-btn"
                title="編集"
                data-id="${t.id}"
                data-cost_date="${t.cost_date?t.cost_date.substring(0,10):""}"
                data-type="${$(t.type||"")}"
                data-amount="${t.amount||""}"
                data-item_description="${$(t.item_description||"")}"
                data-notes="${$(t.notes||"")}">
            <i class="fas fa-edit fa-sm"></i>
        </button>`,f+=`
        <form action="/projects/${l.id}/characters/${e}/costs/${t.id}"
              method="POST" class="delete-cost-form"
              data-id="${t.id}"
              onsubmit="return false;">
            <input type="hidden" name="_token" value="${c}">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit"
                class="p-1 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"
                title="削除">
                <i class="fas fa-trash fa-sm"></i>
            </button>
        </form>`,f+="</div>";const g=`
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 cost-cost_date">${$(i)}</td>
        <td class="px-4 py-1.5 whitespace-nowrap cost-type">${m}</td>
        <td class="px-4 py-1.5 whitespace-nowrap text-gray-700 dark:text-gray-200 cost-amount">${r}</td>
        <td class="px-4 py-1.5 whitespace-normal break-words text-gray-700 dark:text-gray-200 cost-item_description">${$(t.item_description)}</td>
        <td class="px-4 py-1.5 text-gray-700 dark:text-gray-200 whitespace-pre-wrap break-words text-left leading-tight cost-notes" style="min-width: 150px;">
            ${d}
        </td>
        <td class="px-3 py-1.5 whitespace-nowrap text-right">
            ${f}
        </td>
    `;if(n&&s)s.innerHTML=g;else if(!n){const a=document.createElement("tr");a.id=`cost-row-${t.id}`,a.classList.add("hover:bg-gray-50","dark:hover:bg-gray-700/50"),a.innerHTML=g;const b=o.querySelector('td[colspan="6"]');b&&b.parentElement.remove(),o.appendChild(a)}q(e)}function O(e,t,n,l){const o=document.getElementById(`cost-form-${t}`);if(!o)return;const s=o.dataset.storeUrl,d=document.getElementById(`cost-form-title-${t}`),r=document.getElementById(`cost-form-submit-btn-${t}`),i=document.getElementById(`cost-form-submit-btn-text-${t}`),c=document.getElementById(`cost-form-cancel-btn-${t}`),m=document.getElementById(`cost-form-method-${t}`),y=document.getElementById(`cost-form-id-${t}`),f=`cost-form-errors-${t}`;e.addEventListener("click",function(g){const a=g.target.closest(".edit-cost-btn");if(a){g.preventDefault(),d&&(d.textContent="コストを編集"),o.setAttribute("action",`/projects/${l.id}/characters/${t}/costs/${a.dataset.id}`),m&&(m.value="PUT"),y&&(y.value=a.dataset.id),o.querySelector(`[id="cost_cost_date_input-${t}"]`).value=a.dataset.cost_date,o.querySelector(`[id="cost_type_input-${t}"]`).value=a.dataset.type,o.querySelector(`[id="cost_amount_input-${t}"]`).value=a.dataset.amount,o.querySelector(`[id="cost_item_description_input-${t}"]`).value=a.dataset.item_description,o.querySelector(`[id="cost_notes_input-${t}"]`).value=a.dataset.notes||"",i&&(i.textContent="更新"),r&&(r.classList.remove("bg-green-500","hover:bg-green-600"),r.classList.add("bg-yellow-500","hover:bg-yellow-600")),c&&(c.style.display="inline-flex");const u=document.getElementById(f);u&&(u.innerHTML=""),o.querySelector(`[id="cost_cost_date_input-${t}"]`).focus()}const b=g.target.closest(".delete-cost-form");b&&(g.preventDefault(),confirm("このコストを本当に削除しますか？")&&w.delete(b.action,{headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).then(u=>{if(u.data.success){const x=`cost-row-${b.dataset.id}`,p=document.getElementById(x);p&&p.remove(),_(t,s),q(t),u.data.material_status_updated}else v(u,"削除に失敗しました。",f)}).catch(u=>{v(u.response,"削除中にエラーが発生しました。",f)}))}),c&&c.addEventListener("click",function(){_(t,s)}),o.addEventListener("submit",function(g){g.preventDefault();const a=document.getElementById(f);a&&(a.innerHTML="");const b=new FormData(o),u=o.getAttribute("action");let x="post";m&&m.value==="PUT"&&b.append("_method","PUT"),w({method:x,url:u,data:b,headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).then(p=>{if(p.data.success&&p.data.cost){const E=m&&m.value==="PUT";U(t,p.data.cost,E,l),_(t,o.dataset.storeUrl),p.data.material_status_updated}else v(p,"コスト処理に失敗しました。",f)}).catch(p=>{v(p.response,"コスト送信中にエラーが発生しました。",f)})})}function N(){const e=document.getElementById("project-show-main-container");if(!e){console.error("[project-show-main.js] CRITICAL: mainContainer not found. Exiting initialization.");return}const t=e.dataset.projectId,n=h();let l={id:t};if(e.dataset.project)try{l=JSON.parse(e.dataset.project)}catch(s){console.error("[project-show-main.js] Failed to parse project data from HTML attribute:",s)}e.addEventListener("change",function(s){const d=s.target.closest(".project-flag-select, .project-status-select");d&&d.closest(".lg\\:col-span-1")&&H(d,n)}),e.querySelectorAll(".js-character-card").forEach(s=>{const d=s.querySelector('[id^="measurements-content-"]'),r=s.querySelector('[id^="materials-content-"]'),i=s.querySelector('[id^="costs-content-"]');let c=null;d?c=d.id.split("-").pop():r?c=r.id.split("-").pop():i&&(c=i.id.split("-").pop()),c?(d&&P(d,c,n,l),r&&R(r,c,n,l),i&&O(i,c,n,l)):console.warn("[project-show-main.js] Could not determine characterId for a character card. Skipping interactions init.",s)})}document.getElementById("project-show-main-container")&&N();
